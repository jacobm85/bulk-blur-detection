<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Browser</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        .directory {
            font-weight: bold;
            cursor: pointer;
        }
        .file {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>File Browser</h1>
    <div id="file-browser"></div>
    <form id="process-form" method="POST" action="/process">
        <input type="hidden" name="source_folder" id="source_folder">
        <label for="threshold">Threshold:</label>
        <input type="text" name="threshold" id="threshold">
        <button type="submit">Process Images</button>
    </form>

    <script>
        const socket = io();

        function browse(path) {
            socket.emit('browse', {path: path});
        }

        socket.on('files', data => {
            const fileBrowser = document.getElementById('file-browser');
            fileBrowser.innerHTML = '';

            const path = document.createElement('p');
            path.textContent = `Path: ${data.path}`;
            fileBrowser.appendChild(path);

            data.files.forEach(file => {
                const fileElement = document.createElement('div');
                fileElement.textContent = file.name;
                fileElement.className = file.is_dir ? 'directory' : 'file';
                fileElement.onclick = () => {
                    if (file.is_dir) {
                        browse(data.path + '/' + file.name);
                    } else {
                        document.getElementById('source_folder').value = data.path + '/' + file.name;
                    }
                };
                fileBrowser.appendChild(fileElement);
            });

            const selectFolderButton = document.createElement('button');
            selectFolderButton.textContent = 'Select This Folder';
            selectFolderButton.onclick = () => {
                document.getElementById('source_folder').value = data.path;
            };
            fileBrowser.appendChild(selectFolderButton);
        });

        socket.on('error', data => {
            alert(data.message);
        });

        // Start browsing from /app/images
        browse('/app/images');
    </script>
</body>
</html>
